<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Đăng nhập</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: 50px auto; }
        .error { color: #7700ff; }
        input, button { margin: 10px 0; padding: 8px; width: 100%; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
<h2>Đăng nhập</h2>
<form id="login-form">
    <label>Tên đăng nhập:</label>
    <input type="text" name="username" id="username" required/><br/>
    <label>Mật khẩu:</label>
    <input type="password" name="password" id="password" required/><br/>
    <button type="submit">Đăng nhập</button>
</form>

<p id="error-message" class="error"></p>

<script>
    document.getElementById('login-form').addEventListener('submit', async function(event) {
        event.preventDefault();

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        try {
            const response = await fetch('/api/v1/auth/authenticate', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({email: username, password: password})
            });

            if (response.ok) {
                const data = await response.json();
                localStorage.setItem('accessToken', data.accessToken);
                localStorage.setItem('refreshToken', data.refreshToken);
                window.location.href = '/home';
            } else {
                document.getElementById('error-message').innerText = "Sai tên đăng nhập hoặc mật khẩu!";
            }
        } catch (error) {
            document.getElementById('error-message').innerText = "Lỗi hệ thống!";
        }
    });
</script>
</body>
</html>